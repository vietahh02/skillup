<div class="purchase-order-detail-dialog">
  <!-- Header -->
  <div class="dialog-header">
    <h2 class="dialog-title">{{ 'system.purchaseOrder.viewOrder' | translate }}</h2>
    <button mat-icon-button class="close-btn" (click)="close()">
      <mat-icon>close</mat-icon>
    </button>
  </div>

  <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

  <!-- Content -->
  <div class="dialog-content" *ngIf="order && !loading">
    <div class="content-wrapper">
      <!-- Left Side - Order Information -->
      <div class="order-info-section">
        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.orderId' | translate }}:</span>
          <span class="info-value">{{ order.id || order.orderId || '-' }}</span>
        </div>

        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.orderType' | translate }}:</span>
          <span class="info-value">
            <span class="badge" [style.background-color]="getTransactionTypeColor(order.requestType)">
              {{ (order.transactionTypeStr || '') | translate }}
            </span>
          </span>
        </div>

        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.paymentType' | translate }}:</span>
          <span class="info-value">
            <span class="badge badge-blue">{{ order.bankName || 'Bank' }}</span>
          </span>
        </div>

        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.amount' | translate }}:</span>
          <span class="info-value">Ks {{ formatAmount(order.amount) }}</span>
        </div>

        <div class="info-item" *ngIf="order.file">
          <span class="info-label">{{ 'system.purchaseOrder.file' | translate }}:</span>
          <span class="info-value">
            <mat-icon class="file-icon">description</mat-icon>
          </span>
        </div>

        <div class="info-item" *ngIf="order.note">
          <span class="info-label">{{ 'system.purchaseOrder.note' | translate }}:</span>
          <span class="info-value">{{ order.note }}</span>
        </div>

        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.approvalStatus' | translate }}:</span>
          <span class="info-value">
            <mat-icon class="status-icon" [style.color]="getStatusColor(order.status)">check_circle</mat-icon>
            <span class="badge" [style.background-color]="getStatusColor(order.status)">
              {{ (order.statusStr || '') | translate }}
            </span>
          </span>
        </div>

        <div class="info-item">
          <span class="info-label">{{ 'system.purchaseOrder.processStatus' | translate }}:</span>
          <span class="info-value">
            <mat-icon class="status-icon" [style.color]="getStatusColor(order.status)">radio_button_checked</mat-icon>
            <span class="badge" [style.background-color]="getStatusColor(order.status)">
              {{ (order.statusStr || '') | translate }}
            </span>
          </span>
        </div>

        <!-- Additional Info -->
        <div class="info-item" *ngIf="order.partnerName">
          <span class="info-label">{{ 'system.purchaseOrder.partner' | translate }}:</span>
          <span class="info-value">{{ order.partnerName }}</span>
        </div>

        <div class="info-item" *ngIf="order.bankAccount">
          <span class="info-label">{{ 'system.purchaseOrder.bankAccount' | translate }}:</span>
          <span class="info-value">{{ order.bankAccount }}</span>
        </div>

        <div class="info-item" *ngIf="order.bankCode">
          <span class="info-label">{{ 'system.purchaseOrder.bankCode' | translate }}:</span>
          <span class="info-value">{{ order.bankCode }}</span>
        </div>

        <div class="info-item" *ngIf="order.bankTransactionId">
          <span class="info-label">{{ 'system.purchaseOrder.bankTransactionId' | translate }}:</span>
          <span class="info-value">{{ order.bankTransactionId }}</span>
        </div>

        <div class="info-item" *ngIf="order.discount !== undefined && order.discount !== null">
          <span class="info-label">{{ 'system.purchaseOrder.discount' | translate }}:</span>
          <span class="info-value">Ks {{ formatAmount(order.discount) }}</span>
        </div>

        <div class="info-item" *ngIf="order.createdBy">
          <span class="info-label">{{ 'system.purchaseOrder.createdBy' | translate }}:</span>
          <span class="info-value">{{ order.createdBy }}</span>
        </div>

        <div class="info-item" *ngIf="order.approvedBy">
          <span class="info-label">{{ 'system.purchaseOrder.approvedBy' | translate }}:</span>
          <span class="info-value">{{ order.approvedBy }}</span>
        </div>
      </div>

      <!-- Right Side - Timeline -->
      <div class="timeline-section">
        <h3 class="timeline-title">{{ 'system.purchaseOrder.orderTimeline' | translate }}</h3>
        <div class="timeline">
          <!-- Step 1: Order Create -->
          <div class="timeline-item">
            <div class="timeline-dot dot-purple"></div>
            <div class="timeline-content">
              <div class="timeline-header">
                <div class="timeline-step">{{ 'system.purchaseOrder.orderCreate' | translate }}</div>
                <div class="timeline-date">{{ formatDate(order.createdAt) }}</div>
              </div>
              <div class="timeline-actor">{{ order.createdBy || 'MYTELPAY-CHANNEL' }}</div>
            </div>
          </div>

          <!-- Step 2: Approved -->
          <div class="timeline-item" *ngIf="order.approvedBy">
            <div class="timeline-dot dot-blue"></div>
            <div class="timeline-content">
              <div class="timeline-header">
                <div class="timeline-step">{{ 'system.purchaseOrder.approved' | translate }}</div>
                <div class="timeline-date">{{ formatDate(order.updatedAt) }}</div>
              </div>
              <div class="timeline-actor">{{ order.approvedBy }}</div>
            </div>
          </div>

          <!-- Step 3: Completed -->
          <div class="timeline-item" *ngIf="order.status === 2">
            <div class="timeline-dot dot-green"></div>
            <div class="timeline-content">
              <div class="timeline-header">
                <div class="timeline-step">{{ 'system.purchaseOrder.addToWallet' | translate }}</div>
                <div class="timeline-date">{{ formatDate(order.updatedAt) }}</div>
              </div>
              <div class="timeline-actor">system</div>
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- Loading State -->
  <div class="loading-state" *ngIf="loading">
    <p>{{ 'common.loading' | translate }}...</p>
  </div>

    <!-- Footer Actions -->
  <div class="dialog-footer">
      <ng-container *ngIf="showActionButtons">
          <button mat-flat-button class="btn-approve" (click)="onApprove()" [disabled]="loading">
              {{ 'system.notification.approve' | translate }}
          </button>
          <button mat-flat-button class="btn-reject" (click)="onReject()" [disabled]="loading">
              {{ 'system.notification.reject' | translate }}
          </button>
      </ng-container>
      <button mat-flat-button class="btn-back" (click)="close()">
          {{ showActionButtons ? ('system.notification.back' | translate) : ('common.close' | translate) }}
    </button>
  </div>
</div>

