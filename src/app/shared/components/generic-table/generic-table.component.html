<div class="table-card border-radius-size">
    <!-- Loading Bar -->
    <mat-progress-bar *ngIf="loading" mode="indeterminate"></mat-progress-bar>

    <!-- Table Container -->
    <div class="table-container" style="width: 100%;">
        <table mat-table [dataSource]="dataSource" class="table">

            <!-- Sequence Number Column -->
            <ng-container matColumnDef="no" *ngIf="config.showSequenceNumber !== false">
                <th mat-header-cell *matHeaderCellDef class="tb-cell-center">{{ 'common.no_dot' | translate }}</th>
                <td mat-cell *matCellDef="let item; let i = index" class="no-cell tb-cell-center">
                    <span class="no-number" >{{ getSequenceNumber(i) }}</span>
                </td>
            </ng-container>

            <!-- Dynamic Columns -->
            <ng-container *ngFor="let column of config.columns" [matColumnDef]="column.key">
                <th mat-header-cell *matHeaderCellDef
                    [class]="'tb-cell-' + (column.align || 'center') + ' ' + (column.headerClass || '')"
                    [style.width]="column.width"
                    (click)="onSort(column)"
                    [style.cursor]="column.sortable ? 'pointer' : 'default'">
                    <span class="header-content">
                        {{ column.header | translate }}
                        <span *ngIf="column.sortable && sortColumn === column.key" class="sort-indicator">
                            <i *ngIf="sortDirection === 'asc'" class="ri-arrow-up-line"></i>
                            <i *ngIf="sortDirection === 'desc'" class="ri-arrow-down-line"></i>
                        </span>
                    </span>
                </th>

                <td mat-cell *matCellDef="let item"
                    [class]="'tb-cell-' + (column.align || 'center') + ' ' + (column.cellClass || '')"
                    [matTooltip]="column.isTruncate ? getColumnValueNormalized(item, column) : null"
                    >

                    <!-- Text Template -->
                    <span *ngIf="!column.template || column.template === 'text'" [style.color]="getCustomColor(item, column)">
                        @if(column.customValue) {
                            {{ column.isTranslate ? (column.customValue(item) | translate) : column.customValue(item) || '-' }}
                        } @else {
                            {{ column.isTranslate ? (getColumnValue(item, column) | translate) : getColumnValue(item, column) || '-' }}
                        }
                    </span>

                    <!-- Status Pill Template -->
                    <span *ngIf="column.template === 'pill'"
                          class="pill"
                          [style.color]="getCustomColor(item, column)"
                          >
                        @if(column.customValue) {
                            {{ column.isTranslate ? (column.customValue(item) | translate) : column.customValue(item) }}
                        } @else {
                            {{ column.isTranslate ? (getColumnValue(item, column) | translate) : getColumnValue(item, column) }}
                        }
                    </span>

                    <!-- Toggle Template -->
                    <mat-slide-toggle *ngIf="column.template === 'toggle'"
                        [checked]="getToggleValue(item, column)"
                        (change)="onToggleChange(item, column, $event)"
                        color="primary"
                        [style.color]="getCustomColor(item, column)">
                    </mat-slide-toggle>

                    <!-- Custom Template -->
                    <ng-container *ngIf="column.template === 'custom'">
                        <ng-content [select]="'[slot=' + column.key + ']'"></ng-content>
                    </ng-container>
                </td>
            </ng-container>

            <!-- Actions Column -->
            <ng-container matColumnDef="actions" *ngIf="shouldShowActionsColumn()" [style.width]="totalActions * 40 + 'px'">
                <th mat-header-cell *matHeaderCellDef class="tb-cell-center">{{ 'common.actions' | translate }}</th>
                <td mat-cell *matCellDef="let item" class="actions-cell">
                    <div class="actions-grid">
                        <mat-slide-toggle
                            *ngIf="isStatusToggleVisible(item)"
                            [checked]="item._enabled"
                            [disabled]="item._disabled"
                            (change)="onStatusToggleChange(item, $event)"
                            [matTooltip]="'common.changeStatus' | translate"
                            color="primary">
                        </mat-slide-toggle>
                        <ng-container *ngFor="let action of config.actions">
                            <!-- Universal Action Button -->
                            <!-- *ngIf="isActionVisible(action, item)" -->
                            <!-- [style.display]="isActionVisible(action, item) ? 'block' : 'none'" -->
                            <button
                                    mat-icon-button
                                    class="action-btn"
                                    [style.visibility]="isActionVisible(action, item) ? 'visible' : 'hidden'"
                                    [matTooltip]="((action.tooltip || action.label || action.type) | translate) || action.type"
                                    [disabled]="isActionDisabled(action, item)"
                                    (click)="isActionVisible(action, item) ? onActionClick(action, item, $event) : null">
                                <i class="material-symbols-outlined"
                                   [style.color]="action.color || '#000'"
                                   style="font-size: 18px;">
                                    {{ action.icon || 'more_horiz' }}
                                </i>
                            </button>
                        </ng-container>
                    </div>
                </td>
            </ng-container>

            <!-- Table Rows -->
            <tr mat-header-row *matHeaderRowDef="displayedColumns"></tr>
            <tr mat-row *matRowDef="let row; columns: displayedColumns;"
                [class]="config.rowClass ? config.rowClass(row) : ''"></tr>

            <!-- No Data Row -->
            <tr class="mat-row" *matNoDataRow>
                <td class="mat-cell" [attr.colspan]="displayedColumns.length" style="text-align: center; padding: 2rem;">
                    {{ config.emptyMessage || 'common.noData' | translate }}
                </td>
            </tr>
        </table>
    </div>

    <!-- Pagination Section -->
    <app-generic-pagination
        *ngIf="config.enablePagination !== false"
        [pagination]="{ currentPage: currentPage, pageSize: pageSize, totalItems: totalItems, totalPages: totalPages }"
        [pageSizeOptions]="pageSizeOptions"
        [loading]="loading"
        (pageChange)="onPageChangeClick($event)"
        (pageSizeChange)="onPageSizeChangeSelect($event)">
    </app-generic-pagination>

</div>
